<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=1920">
<title>Busching Autoteile</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: Arial, Helvetica, sans-serif;
  background: #0a0a0a;
  color: #ffffff;
  width: 1920px;
  height: 1080px;
  overflow: hidden;
}
.main {
  width: 100%;
  height: 100%;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column;
  flex-direction: column;
}

/* ===== STATUS BANNER - VOLLE BREITE, ZENTRIERT, GANZ OBEN ===== */
.status-banner {
  width: 100%;
  text-align: center;
  padding: 28px 0;
  font-size: 110px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 20px;
}
.status-open {
  background: #003d1f;
  color: #00ff88;
  border-bottom: 6px solid #00ff88;
  text-shadow: 0 0 40px rgba(0, 255, 136, 0.6);
}
.status-closed {
  background: #3d0011;
  color: #ff3355;
  border-bottom: 6px solid #ff3355;
  text-shadow: 0 0 40px rgba(255, 51, 85, 0.6);
}
.status-lunch {
  background: #3d2e00;
  color: #ffcc00;
  border-bottom: 6px solid #ffcc00;
  text-shadow: 0 0 40px rgba(255, 204, 0, 0.6);
}
.status-warning {
  background: #3d2e00;
  color: #ffcc00;
  border-bottom: 6px solid #ffcc00;
  text-shadow: 0 0 40px rgba(255, 204, 0, 0.6);
}

/* ===== BODY CONTENT ===== */
.body-content {
  display: -webkit-flex;
  display: flex;
  -webkit-flex: 1;
  flex: 1;
  padding: 30px 50px 15px;
  gap: 50px;
}
.col-left {
  -webkit-flex: 1;
  flex: 1;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column;
  flex-direction: column;
  gap: 20px;
}
.col-right {
  -webkit-flex: 1;
  flex: 1;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column;
  flex-direction: column;
  gap: 20px;
}

/* ===== LOGO + FIRMENNAME ===== */
.brand-row {
  display: -webkit-flex;
  display: flex;
  -webkit-align-items: center;
  align-items: center;
  gap: 25px;
  margin-bottom: 10px;
}
.logo { height: 110px; width: auto; }
.brand-name {
  font-size: 48px;
  font-weight: bold;
  color: #ffd700;
  letter-spacing: 2px;
}

/* ===== PANELS ===== */
.panel {
  background: #1a1a1a;
  border: 2px solid #333333;
  border-radius: 16px;
  padding: 28px 35px;
}
.panel-title {
  font-size: 50px;
  font-weight: bold;
  color: #ffd700;
  text-transform: uppercase;
  letter-spacing: 3px;
  margin-bottom: 22px;
  padding-bottom: 14px;
  border-bottom: 3px solid #444444;
}

/* ===== HOURS - GROSS ===== */
.hours-table {
  width: 100%;
}
.hours-row {
  display: -webkit-flex;
  display: flex;
  -webkit-align-items: baseline;
  align-items: baseline;
  margin-bottom: 10px;
}
.day-label {
  color: #ffd700;
  font-weight: bold;
  font-size: 52px;
  width: 300px;
  -webkit-flex-shrink: 0;
  flex-shrink: 0;
}
.time-val {
  color: #ffffff;
  font-size: 54px;
  font-weight: bold;
}
.time-separator {
  height: 16px;
}

/* ===== CONTACT ===== */
.company-title {
  font-size: 44px;
  font-weight: bold;
  color: #ffd700;
  text-transform: uppercase;
  letter-spacing: 2px;
  margin-bottom: 18px;
}
.contact-line {
  font-size: 38px;
  line-height: 1.6;
  color: #cccccc;
}
.contact-phone {
  color: #ffffff;
  font-weight: bold;
  font-size: 50px;
  display: block;
  margin-top: 14px;
}
.contact-email {
  color: #ffffff;
  font-weight: bold;
  font-size: 38px;
  display: block;
  margin-top: 10px;
}

/* ===== NOTICE ===== */
.notice {
  background: #1a1a0a;
  border-left: 6px solid #ffd700;
  border-radius: 12px;
  padding: 22px 28px;
  font-size: 36px;
  color: #ffd700;
  line-height: 1.4;
}

/* ===== CUSTOM MESSAGE ===== */
.big-message {
  font-size: 64px;
  font-weight: bold;
  text-align: center;
  line-height: 1.4;
  padding: 20px 0;
}
.big-message.green { color: #00ff88; }
.big-message.red { color: #ff3355; }
.big-message.yellow { color: #ffcc00; }
.subtitle-text {
  font-size: 40px;
  color: #aaaaaa;
  text-align: center;
  margin-top: 10px;
}

/* ===== FOOTER BAR ===== */
.footer {
  display: -webkit-flex;
  display: flex;
  -webkit-justify-content: space-between;
  justify-content: space-between;
  -webkit-align-items: center;
  align-items: center;
  padding: 12px 50px;
  border-top: 3px solid #333333;
}
.footer-left {
  font-size: 30px;
  color: #888888;
}
.footer-phone {
  font-size: 36px;
  color: #ffffff;
  font-weight: bold;
}
</style>
</head>
<body>
<div class="main" id="display-content">
</div>

<script>
// ===== KONFIGURATION =====
var CONFIG = {
  statusUrl: 'status.json',
  refreshInterval: 15000,
  hours: {
    1: [{open: '10:00', close: '13:00'}, {open: '14:00', close: '18:00'}],
    2: [{open: '09:00', close: '13:00'}, {open: '14:00', close: '18:00'}],
    3: [{open: '09:00', close: '13:00'}, {open: '14:00', close: '18:00'}],
    4: [{open: '09:00', close: '13:00'}, {open: '14:00', close: '18:00'}],
    5: [{open: '09:00', close: '13:00'}, {open: '14:00', close: '18:00'}],
    6: [],
    0: []
  },
  lunchBreak: {start: '13:00', end: '14:00'}
};

// ===== STATUS-ANZEIGE =====
function getStatusClass(mode) {
  switch(mode) {
    case 'open': return 'status-open';
    case 'closed': return 'status-closed';
    case 'lunch': return 'status-lunch';
    case 'warning': return 'status-warning';
    default: return 'status-open';
  }
}

function getStatusText(mode) {
  switch(mode) {
    case 'open': return 'GE\u00D6FFNET';
    case 'closed': return 'GESCHLOSSEN';
    case 'lunch': return 'MITTAGSPAUSE';
    case 'warning': return 'HINWEIS';
    default: return 'GE\u00D6FFNET';
  }
}

function renderDisplay(data) {
  var mode = data.mode || 'open';
  var customMessage = data.customMessage || '';
  var customSubtitle = data.customSubtitle || '';

  var html = '';

  // STATUS BANNER - volle Breite, zentriert, ganz oben
  html += '<div class="status-banner ' + getStatusClass(mode) + '">' + getStatusText(mode) + '</div>';

  // BODY CONTENT
  html += '<div class="body-content">';

  // LINKE SPALTE
  html += '<div class="col-left">';

  // Logo + Firmenname
  html += '<div class="brand-row">';
  html += '  <img src="logo.png" alt="Busching" class="logo">';
  html += '  <div class="brand-name">Busching Autoteile</div>';
  html += '</div>';

  // Oeffnungszeiten
  html += '<div class="panel">';
  html += '  <div class="panel-title">\u00D6ffnungszeiten</div>';
  html += '  <div class="hours-table">';
  html += '    <div class="hours-row"><span class="day-label">Montag:</span><span class="time-val">10:00 - 13:00</span></div>';
  html += '    <div class="hours-row"><span class="day-label"></span><span class="time-val">14:00 - 18:00 Uhr</span></div>';
  html += '    <div class="time-separator"></div>';
  html += '    <div class="hours-row"><span class="day-label">Di - Fr:</span><span class="time-val">09:00 - 13:00</span></div>';
  html += '    <div class="hours-row"><span class="day-label"></span><span class="time-val">14:00 - 18:00 Uhr</span></div>';
  html += '  </div>';
  html += '</div>';

  html += '</div>';

  // RECHTE SPALTE
  html += '<div class="col-right">';

  // Kontakt
  html += '<div class="panel">';
  html += '  <div class="company-title">Busching Autoteile GmbH</div>';
  html += '  <div class="contact-line">';
  html += '    Otto-Suhr-Allee 29, 10585 Berlin';
  html += '    <span class="contact-phone">Tel. 030 - 342 20 23</span>';
  html += '    <span class="contact-email">info@busching-autoteile.com</span>';
  html += '  </div>';
  html += '</div>';

  // Custom Message oder Hinweis
  if (customMessage) {
    html += '<div class="panel">';
    var msgColor = mode === 'closed' ? 'red' : (mode === 'lunch' ? 'yellow' : (mode === 'warning' ? 'yellow' : 'green'));
    html += '  <div class="big-message ' + msgColor + '">' + customMessage + '</div>';
    if (customSubtitle) {
      html += '  <div class="subtitle-text">' + customSubtitle + '</div>';
    }
    html += '</div>';
  } else {
    html += '<div class="notice">';
    html += '  Dar\u00FCber hinaus \u00F6ffnen wir bei Bedarf (z.B. bei Frostwetter) oder nach telefonischer Vereinbarung.';
    html += '</div>';
  }

  html += '</div>';
  html += '</div>';

  // FOOTER
  html += '<div class="footer">';
  html += '  <div class="footer-left">Busching Autoteile GmbH &bull; Otto-Suhr-Allee 29 &bull; 10585 Berlin</div>';
  html += '  <div class="footer-phone">Tel. 030 - 342 20 23</div>';
  html += '</div>';

  document.getElementById('display-content').innerHTML = html;
}

// ===== AUTO-REFRESH MIT CACHE-BUSTING =====
var lastStatus = null;

function loadStatus() {
  var url = CONFIG.statusUrl + '?t=' + new Date().getTime();
  var xhr = new XMLHttpRequest();
  xhr.open('GET', url, true);
  xhr.setRequestHeader('Cache-Control', 'no-cache, no-store, must-revalidate');
  xhr.setRequestHeader('Pragma', 'no-cache');
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4) {
      if (xhr.status === 200) {
        try {
          var data = JSON.parse(xhr.responseText);
          lastStatus = data;
          renderDisplay(data);
        } catch(e) {
          if (!lastStatus) {
            renderDisplay(getAutoStatus());
          }
        }
      } else {
        if (!lastStatus) {
          renderDisplay(getAutoStatus());
        }
      }
    }
  };
  xhr.send();
}

// ===== LOKALE ZEITSTEUERUNG (FALLBACK) =====
function getAutoStatus() {
  var now = new Date();
  var berlinTime = new Date(now.toLocaleString('en-US', {timeZone: 'Europe/Berlin'}));
  var day = berlinTime.getDay();
  var hours = berlinTime.getHours();
  var minutes = berlinTime.getMinutes();
  var currentMinutes = hours * 60 + minutes;

  var todayHours = CONFIG.hours[day] || [];

  // Kein Arbeitstag
  if (todayHours.length === 0) {
    return { mode: 'closed', customMessage: '', customSubtitle: '', source: 'auto-local' };
  }

  // Mittagspause pruefen (13:00 - 14:00)
  var lunchStart = 13 * 60;
  var lunchEnd = 14 * 60;
  if (todayHours.length > 1 && currentMinutes >= lunchStart && currentMinutes < lunchEnd) {
    return { mode: 'lunch', customMessage: '', customSubtitle: '', source: 'auto-local' };
  }

  // Oeffnungszeiten pruefen
  for (var i = 0; i < todayHours.length; i++) {
    var slot = todayHours[i];
    var openParts = slot.open.split(':');
    var closeParts = slot.close.split(':');
    var openMin = parseInt(openParts[0]) * 60 + parseInt(openParts[1]);
    var closeMin = parseInt(closeParts[0]) * 60 + parseInt(closeParts[1]);
    if (currentMinutes >= openMin && currentMinutes < closeMin) {
      return { mode: 'open', customMessage: '', customSubtitle: '', source: 'auto-local' };
    }
  }

  return { mode: 'closed', customMessage: '', customSubtitle: '', source: 'auto-local' };
}

// ===== START =====
loadStatus();
setInterval(loadStatus, CONFIG.refreshInterval);

// Seite komplett neu laden alle 5 Minuten (gegen Memory-Leaks auf Samsung Tizen)
setTimeout(function() {
  setInterval(function() {
    window.location.reload(true);
  }, 300000);
}, 5000);
</script>
</body>
</html>
