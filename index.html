<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=1920">
<title>Busching Autoteile</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: Arial, Helvetica, sans-serif;
  background: #0a0a0a;
  color: #ffffff;
  width: 1920px;
  height: 1080px;
  overflow: hidden;
  padding: 30px 40px;
}
.main {
  width: 100%;
  height: 100%;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column;
  flex-direction: column;
}

/* ===== HEADER ===== */
.header {
  display: -webkit-flex;
  display: flex;
  -webkit-justify-content: space-between;
  justify-content: space-between;
  -webkit-align-items: center;
  align-items: center;
  padding-bottom: 20px;
  border-bottom: 4px solid #333333;
  margin-bottom: 20px;
}
.logo { height: 120px; width: auto; }
.status {
  font-size: 80px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 8px;
  padding: 16px 50px;
  border: 5px solid;
  border-radius: 16px;
}
.status-open {
  color: #00ee77;
  border-color: #00ee77;
  text-shadow: 0 0 30px rgba(0, 238, 119, 0.5);
}
.status-closed {
  color: #ff3355;
  border-color: #ff3355;
  text-shadow: 0 0 30px rgba(255, 51, 85, 0.5);
}
.status-warning {
  color: #ffbb00;
  border-color: #ffbb00;
  text-shadow: 0 0 30px rgba(255, 187, 0, 0.5);
}

/* ===== CONTENT ===== */
.content {
  display: -webkit-flex;
  display: flex;
  -webkit-flex: 1;
  flex: 1;
  gap: 30px;
}
.col-left {
  -webkit-flex: 1;
  flex: 1;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column;
  flex-direction: column;
  gap: 20px;
}
.col-right {
  -webkit-flex: 1;
  flex: 1;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column;
  flex-direction: column;
  gap: 20px;
}

/* ===== PANELS ===== */
.panel {
  background: #1a1a1a;
  border: 2px solid #333333;
  border-radius: 16px;
  padding: 25px 30px;
}
.panel-title {
  font-size: 44px;
  font-weight: bold;
  color: #ffd700;
  text-transform: uppercase;
  letter-spacing: 3px;
  margin-bottom: 20px;
  padding-bottom: 12px;
  border-bottom: 3px solid #444444;
}

/* ===== HOURS - EXTRA LARGE ===== */
.hours-table {
  width: 100%;
}
.hours-row {
  display: -webkit-flex;
  display: flex;
  -webkit-align-items: baseline;
  align-items: baseline;
  margin-bottom: 8px;
}
.day-label {
  color: #ffd700;
  font-weight: bold;
  font-size: 46px;
  width: 280px;
  -webkit-flex-shrink: 0;
  flex-shrink: 0;
}
.time-val {
  color: #ffffff;
  font-size: 48px;
  font-weight: bold;
}
.time-separator {
  height: 12px;
}

/* ===== CONTACT ===== */
.company-name {
  font-size: 42px;
  font-weight: bold;
  color: #ffd700;
  text-transform: uppercase;
  letter-spacing: 2px;
  margin-bottom: 15px;
}
.contact-line {
  font-size: 36px;
  line-height: 1.6;
  color: #cccccc;
}
.contact-phone {
  color: #ffffff;
  font-weight: bold;
  font-size: 48px;
  display: block;
  margin-top: 12px;
}
.contact-email {
  color: #ffffff;
  font-weight: bold;
  font-size: 36px;
  display: block;
  margin-top: 8px;
}

/* ===== NOTICE ===== */
.notice {
  background: #1a1a0a;
  border-left: 6px solid #ffd700;
  border-radius: 12px;
  padding: 20px 25px;
  font-size: 34px;
  color: #ffd700;
  line-height: 1.4;
}

/* ===== EMERGENCY ===== */
.emergency {
  background: #1a0a0a;
  border-left: 6px solid #ff3355;
  border-radius: 12px;
  padding: 20px 25px;
}
.emergency-title {
  color: #ff3355;
  font-weight: bold;
  font-size: 38px;
  margin-bottom: 10px;
}
.emergency-details {
  color: #ffffff;
  font-size: 40px;
  font-weight: bold;
  line-height: 1.5;
}

/* ===== SPECIAL TEXT ===== */
.big-message {
  font-size: 60px;
  font-weight: bold;
  text-align: center;
  line-height: 1.4;
  padding: 20px 0;
}
.big-message.green { color: #00ee77; }
.big-message.red { color: #ff3355; }
.big-message.yellow { color: #ffbb00; }
.big-message.white { color: #ffffff; }

.subtitle-text {
  font-size: 38px;
  color: #aaaaaa;
  text-align: center;
  margin-top: 10px;
}

/* ===== FOOTER BAR ===== */
.footer {
  display: -webkit-flex;
  display: flex;
  -webkit-justify-content: space-between;
  justify-content: space-between;
  -webkit-align-items: center;
  align-items: center;
  padding-top: 15px;
  border-top: 3px solid #333333;
  margin-top: 15px;
}
.footer-left {
  font-size: 30px;
  color: #888888;
}
.footer-phone {
  font-size: 36px;
  color: #ffffff;
  font-weight: bold;
}
</style>
</head>
<body>
<div class="main" id="display-content">
  <!-- Content wird dynamisch aus status.json geladen -->
</div>

<script>
// ===== KONFIGURATION =====
var CONFIG = {
  // Status-Datei wird aus dem gleichen Verzeichnis geladen
  statusUrl: 'status.json',
  // Refresh-Intervall in Millisekunden (15 Sekunden)
  refreshInterval: 15000,
  // Öffnungszeiten (für lokale Zeitsteuerung als Fallback)
  hours: {
    1: [{open: '10:00', close: '13:00'}, {open: '14:00', close: '18:00'}], // Montag
    2: [{open: '09:00', close: '13:00'}, {open: '14:00', close: '18:00'}], // Dienstag
    3: [{open: '09:00', close: '13:00'}, {open: '14:00', close: '18:00'}], // Mittwoch
    4: [{open: '09:00', close: '13:00'}, {open: '14:00', close: '18:00'}], // Donnerstag
    5: [{open: '09:00', close: '13:00'}, {open: '14:00', close: '18:00'}], // Freitag
    6: [],  // Samstag - geschlossen
    0: []   // Sonntag - geschlossen
  }
};

// ===== TEMPLATES =====
function getStatusClass(mode) {
  switch(mode) {
    case 'open': return 'status-open';
    case 'closed': return 'status-closed';
    case 'warning': return 'status-warning';
    default: return 'status-open';
  }
}

function getStatusText(mode) {
  switch(mode) {
    case 'open': return 'GEOEFFNET';
    case 'closed': return 'GESCHLOSSEN';
    case 'warning': return 'HINWEIS';
    default: return 'GEOEFFNET';
  }
}

function renderDisplay(data) {
  var mode = data.mode || 'open';
  var customMessage = data.customMessage || '';
  var customSubtitle = data.customSubtitle || '';

  var html = '';
  html += '<div class="header">';
  html += '  <div class="status ' + getStatusClass(mode) + '">' + getStatusText(mode) + '</div>';
  html += '  <img src="logo.png" alt="Busching" class="logo">';
  html += '</div>';
  html += '<div class="content">';
  html += '  <div class="col-left">';
  html += '    <div class="panel">';
  html += '      <div class="panel-title">Oeffnungszeiten</div>';
  html += '      <div class="hours-table">';
  html += '        <div class="hours-row"><span class="day-label">Montag:</span><span class="time-val">10:00 - 13:00</span></div>';
  html += '        <div class="hours-row"><span class="day-label"></span><span class="time-val">14:00 - 18:00 Uhr</span></div>';
  html += '        <div class="time-separator"></div>';
  html += '        <div class="hours-row"><span class="day-label">Di - Fr:</span><span class="time-val">09:00 - 13:00</span></div>';
  html += '        <div class="hours-row"><span class="day-label"></span><span class="time-val">14:00 - 18:00 Uhr</span></div>';
  html += '      </div>';
  html += '    </div>';

  // Custom Message anzeigen falls vorhanden
  if (customMessage) {
    html += '    <div class="panel">';
    var msgColor = mode === 'closed' ? 'red' : (mode === 'warning' ? 'yellow' : 'green');
    html += '      <div class="big-message ' + msgColor + '">' + customMessage + '</div>';
    if (customSubtitle) {
      html += '      <div class="subtitle-text">' + customSubtitle + '</div>';
    }
    html += '    </div>';
  }

  html += '  </div>';
  html += '  <div class="col-right">';
  html += '    <div class="panel">';
  html += '      <div class="company-name">Busching Autoteile GmbH</div>';
  html += '      <div class="contact-line">';
  html += '        Otto-Suhr-Allee 29, 10585 Berlin';
  html += '        <span class="contact-phone">Tel. 030 - 342 20 23</span>';
  html += '        <span class="contact-email">info@busching-autoteile.com</span>';
  html += '      </div>';
  html += '    </div>';
  html += '    <div class="notice">';
  html += '      Darueber hinaus oeffnen wir bei Bedarf (z.B. bei Frostwetter) oder nach telefonischer Vereinbarung.';
  html += '    </div>';
  html += '  </div>';
  html += '</div>';
  html += '<div class="footer">';
  html += '  <div class="footer-left">Busching Autoteile GmbH &bull; Otto-Suhr-Allee 29 &bull; 10585 Berlin</div>';
  html += '  <div class="footer-phone">Tel. 030 - 342 20 23</div>';
  html += '</div>';

  document.getElementById('display-content').innerHTML = html;
}

// ===== AUTO-REFRESH MIT CACHE-BUSTING =====
var lastStatus = null;

function loadStatus() {
  var url = CONFIG.statusUrl + '?t=' + new Date().getTime();
  var xhr = new XMLHttpRequest();
  xhr.open('GET', url, true);
  xhr.setRequestHeader('Cache-Control', 'no-cache, no-store, must-revalidate');
  xhr.setRequestHeader('Pragma', 'no-cache');
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4) {
      if (xhr.status === 200) {
        try {
          var data = JSON.parse(xhr.responseText);
          lastStatus = data;
          renderDisplay(data);
        } catch(e) {
          // JSON Parse-Fehler - Fallback auf lokale Zeitsteuerung
          if (!lastStatus) {
            renderDisplay(getAutoStatus());
          }
        }
      } else {
        // Datei nicht gefunden oder Fehler - Fallback auf lokale Zeitsteuerung
        if (!lastStatus) {
          renderDisplay(getAutoStatus());
        }
      }
    }
  };
  xhr.send();
}

// ===== LOKALE ZEITSTEUERUNG (FALLBACK) =====
function getAutoStatus() {
  var now = new Date();
  // Berliner Zeit berechnen (UTC+1 bzw UTC+2 bei Sommerzeit)
  var berlinTime = new Date(now.toLocaleString('en-US', {timeZone: 'Europe/Berlin'}));
  var day = berlinTime.getDay();
  var hours = berlinTime.getHours();
  var minutes = berlinTime.getMinutes();
  var currentMinutes = hours * 60 + minutes;

  var todayHours = CONFIG.hours[day] || [];
  var isOpen = false;

  for (var i = 0; i < todayHours.length; i++) {
    var slot = todayHours[i];
    var openParts = slot.open.split(':');
    var closeParts = slot.close.split(':');
    var openMin = parseInt(openParts[0]) * 60 + parseInt(openParts[1]);
    var closeMin = parseInt(closeParts[0]) * 60 + parseInt(closeParts[1]);
    if (currentMinutes >= openMin && currentMinutes < closeMin) {
      isOpen = true;
      break;
    }
  }

  return {
    mode: isOpen ? 'open' : 'closed',
    customMessage: '',
    customSubtitle: '',
    source: 'auto'
  };
}

// ===== START =====
// Sofort laden
loadStatus();

// Alle 15 Sekunden aktualisieren
setInterval(loadStatus, CONFIG.refreshInterval);

// Zusätzlich: Seite komplett neu laden alle 5 Minuten (gegen Memory-Leaks auf Samsung Tizen)
setTimeout(function() {
  setInterval(function() {
    window.location.reload(true);
  }, 300000);
}, 5000);
</script>
</body>
</html>
